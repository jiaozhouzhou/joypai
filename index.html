<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>joypay绝拍网</title>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/public.css" rel="stylesheet"/>
    <link href="css/pbl.css" rel="stylesheet"/>
    <style>
    /*em或者rem弹性布局在IE firefox中 比值 1:10  在chrome 比值 1:12*/
    html {font-size: 62.5%;}
    body{min-width:1280px;font:12px/1.5 "\u5fae\u8f6f\u96c5\u9ed1","\5FAE\8F6F\96C5\9ED1",tahoma,arial,"\5b8b\4f53",sans-serif;}
    header{position:fixed;top:0px;z-index:10;background:#000;width:100%;height:6rem;color:#fff;border-bottom:3px solid #EC971F;}
    .body-con{width:1190px;height:100%;margin:0 auto;}
    #main{margin-top:6.3rem;}
    h2{width:100px;height:6rem;line-height:6rem;font-size:2.4rem;}
    </style>
</head>
<body>
	<header>
		<div class="body-con">
			<h2>绝拍网</h2>
			<!--<ul class="nav">
				<li>普通拍賣品</li>
				<li>手工拍賣品</li>
			</ul>-->
		</div>
	</header>
	<section id="main" class="body-con">
		 <div id="wrap">
            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/1.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>
            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/2.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>

            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/3.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>

            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/4.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>
            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/5.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>

            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/6.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>
            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/7.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>

            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/8.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>
            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/9.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>

            <div class="box">
                <div class="info">
                    <div class="pic"><img src="images/10.jpg"></div>
                    <div class="title"><a href="#">美女</a></div>
                </div>
            </div>

        </div>

	</section>
	<footer>
		<!--這裡是底部-->
	</footer>
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="js/jquery-Wookmark.js"></script>
	<script src="js/mui.min.js"></script>
	<script type="text/javascript" charset="utf-8">
    mui.init();  	
     window.onload = function() {
        //运行瀑布流主函数
        PBL('wrap', 'box');
        //设置滚动加载
        window.onscroll = function() {
        	//模拟数据
	        var data = [
	           {'src': 'sgy01.jpg', 'title': '手工品'}, 
	           {'src': 'sgy02.jpg', 'title': '手工'}, 
	           {'src': 'sgy03.jpg', 'title': '手工'}, 
	           {'src': 'sgy04.jpg', 'title': '手工'},
	           {'src': 'sgy05.jpg', 'title': '手工'},
	           {'src': 'sgy06.jpg', 'title': '手工'}, 
	           {'src': 'sgy07.jpg', 'title': '手工'}, 
	           {'src': 'sgy08.jpg', 'title': '手工'}, 
	           {'src': 'sgy09.jpg', 'title': '手工'}, 
	           {'src': 'sgy10.jpg', 'title': '手工'}
	        ];
            //校验数据请求
            if (getCheck()) {
                var wrap = document.getElementById('wrap');
                for (i in data) {
                    //创建box
                    var box = document.createElement('div');
                    box.className = 'box';
                    wrap.appendChild(box);
                    //创建info
                    var info = document.createElement('div');
                    info.className = 'info';
                    box.appendChild(info);
                    //创建pic
                    var pic = document.createElement('div');
                    pic.className = 'pic';
                    info.appendChild(pic);
                    //创建img
                    var img = document.createElement('img');
                    img.src = 'images/' + data[i].src;
                    img.style.height = 'auto';
                    pic.appendChild(img);
                    //创建title
                    var title = document.createElement('div');
                    title.className = 'title';
                    info.appendChild(title);
                    //创建a标记
                    var a = document.createElement('a');
                    a.innerHTML = data[i].title;
                    title.appendChild(a);
                }
                PBL('wrap', 'box');
            }
        }
    }
    /**
      * 瀑布流主函数
      * @param  wrap	[Str] 外层元素的ID
      * @param  box 	[Str] 每一个box的类名
    */
            function PBL(wrap, box) {
                //	1.获得外层以及每一个box
                var wrap = document.getElementById(wrap);
                var boxs = getClass(wrap, box);
                //	2.获得屏幕可显示的列数
                var boxW = boxs[0].offsetWidth;
                var colsNum = Math.floor(document.documentElement.clientWidth / boxW);
                //alert(colsNum);
                wrap.style.width = boxW * colsNum + 'px';//为外层赋值宽度
                //	3.循环出所有的box并按照瀑布流排列
                var everyH = [];//定义一个数组存储每一列的高度
                for (var i = 0; i < boxs.length; i++) {
                    if (i < colsNum) {
                        everyH[i] = boxs[i].offsetHeight;
                    } else {
                        var minH = Math.min.apply(null, everyH);//获得最小的列的高度
                        var minIndex = getIndex(minH, everyH); //获得最小列的索引
                        getStyle(boxs[i], minH, boxs[minIndex].offsetLeft, i);
                        everyH[minIndex] += boxs[i].offsetHeight;//更新最小列的高度
                    }
                }
            }
            /**
             * 获取类元素
             * @param  warp		[Obj] 外层
             * @param  className	[Str] 类名
             */
            function getClass(wrap, className) {
                var obj = wrap.getElementsByTagName('*');
                var arr = [];
                for (var i = 0; i < obj.length; i++) {
                    if (obj[i].className == className) {
                        arr.push(obj[i]);
                    }
                }
                return arr;
            }
            /**
             * 获取最小列的索引
             * @param  minH	 [Num] 最小高度
             * @param  everyH [Arr] 所有列高度的数组
             */
            function getIndex(minH, everyH) {
                for (index in everyH) {
                    if (everyH[index] == minH)
                        return index;
                }
            }
            /**
             * 数据请求检验
             */
            function getCheck() {
                var documentH = document.documentElement.clientHeight;
                var scrollH = document.documentElement.scrollTop || document.body.scrollTop;
                return documentH + scrollH >= getLastH() ? true : false;
            }
            /**
             * 获得最后一个box所在列的高度
             */
            function getLastH() {
                var wrap = document.getElementById('wrap');
                var boxs = getClass(wrap, 'box');
                return boxs[boxs.length - 1].offsetTop + boxs[boxs.length - 1].offsetHeight;
            }
            /**
             * 设置加载样式
             * @param  box 	[obj] 设置的Box
             * @param  top 	[Num] box的top值
             * @param  left 	[Num] box的left值
             * @param  index [Num] box的第几个
             */
            var getStartNum = 0;//设置请求加载的条数的位置
            function getStyle(box, top, left, index) {
                if (getStartNum >= index)
                    return;
                $(box).css({
                    'position': 'absolute',
                    'top': top,
                    "left": left,
                    "opacity": "0"
                });
                $(box).stop().animate({
                    "opacity": "1"
                }, 999);
                getStartNum = index;//更新请求数据的条数位置
            }
    </script>

</body>
</html>